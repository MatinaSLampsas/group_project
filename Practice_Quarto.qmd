---
title: "STAT 331 Group Project"
author: "Katrina, Matina, Lindsey, Kaviya"
format: 
  html:
    self-contained: true
    embed-resources: true
    code-tools: true
    toc: true
editor: visual
execute: 
  error: true
  echo: true
  message: false
  warning: false
---

## Our Hypothesis

Higher CO2 emissions per capita are associated with lower life expectancy.

## About the Data

The data consists of two datasets that come from [Gapminder](https://www.gapminder.org/data/): Life Expectancy (`life_expectancy_at_birth.csv`) and Consumption-Based CO2 Emissions Per Capita (`co2_pcap_cons.csv`).

In the dataset for Life Expectancy (`life_expectancy_at_birth.csv`), the data collected includes the number of years a newborn infant would live if the current mortality rates at different ages were to stay the same throughout its life across different countries. The dataset originally had 195 rows and 302 columns. After filtering and cleaning, the data consists of 186 rows and 24 columns with mainly double data types. Each row represents a country, with each column representing the life expectancy for a particular country across years from 2000 to 2022. More information about this dataset and its documentation can be found here: [Life Expectancy](https://www.gapminder.org/data/documentation/gd004/).

In the dataset for Consumption-Based CO2 Emissions Per Capita (`co2_pcap_cons.csv`), the data collected includes the average amount of carbon dioxide emissions per person, taking into account consumption patterns, across different countries. The dataset originally had 194 rows and 224 columns. After filtering and cleaning, the data consists of 194 rows and 24 columns with mainly double data types. Each row provides information about the CO2 emissions per capita for a particular country across years from 2000 to 2022. More information about this dataset and its documentation can be found here: [CO2 Emissions Consumption Historic Dataset](https://docs.google.com/spreadsheets/d/1t_GOXGrXQgSasIB7dWfRrq9dkqjrqwy3xHvywH7ah1A/edit#gid=501532268).

## Data Set-Up

```{r}
# Accessing libraries
library(tidyverse)
library(janitor)
```

```{r}
# Load in the life expectancy csv
life_exp <-read_csv(here::here("life_expectancy_at_birth.csv"))

#load in the carbon emissions data 
carbon <-read_csv(here::here("co2_pcap_cons.csv"))

```

## Data Cleaning

```{r}
#cleaning carbon
clean_carbon <- carbon %>% 
  na.omit() %>% 
  mutate(across(.cols = `2000`:`2022`, 
                .fns = ~as.numeric(.x))) %>% 
  select(country, `2000`:`2022`)

clean_life_exp <- life_exp %>% 
  na.omit() %>% 
  mutate(across(.cols = `2000`:`2022`, 
                .fns = ~as.numeric(.x))) %>% 
  select(country, `2000`:`2022`)
```

## Pivot the Data Longer

```{r}
# Pivot longer the clean carbon data: 
clean_carbon <- clean_carbon %>%
  pivot_longer(cols = !country,
               names_to = "year",
               values_to = "carbon_emissions_tonnes")


# Pivot longer the clean life expectancy data:
clean_life_exp <- clean_life_exp %>%
  pivot_longer(cols = !country,
               names_to = "year",
               values_to = "life_expectancy_years")
```

## Joining the Data Sets:

```{r}
#joining the two cleaned data sets 
joined_data <- left_join(clean_carbon, clean_life_exp, by = c("country", "year"))

```

# Linear Regression

### Visual 1 Table

```{r}
#The relationship between the two quantitative variables changing over time. 

vis_1_df <-
joined_data %>% 
  mutate(carbon_emissions_tonnes = 
            case_when(carbon_emissions_tonnes < 2 ~ "< 2 tonnes",
            carbon_emissions_tonnes >2 & carbon_emissions_tonnes<5 ~ "2-5 tonnes",
            carbon_emissions_tonnes > 5 ~ ">5 tonnes")) %>% 
  drop_na() %>%
  mutate(year=as.numeric(year))
vis_1_df
```

### Visual 2 Table

```{r}


#finding the countries with the top 10 carbon emissions over 22 year average
top_ten_carbon <- joined_data %>% 
  group_by(country) %>% 
  summarise(avg_crbn = mean(carbon_emissions_tonnes, na.rm=T),
         avg_life = mean(life_expectancy_years, na.rm=T)) %>%
  #slicing the countries with the top 10 carbon emissions so we can see what they are and how the life expectance vs carbon emissions changes over time
  slice_max(avg_crbn, n=10) %>% 
  arrange(desc(avg_crbn))

```

# Data Visuals

### Data Visual 1

```{r}
joined_data %>% 
  mutate(year = as.numeric(year)) %>% 
  ggplot(mapping = aes (x = year,
                        y = life_expectancy_years, 
                        alpha = carbon_emissions_tonnes)) +
  geom_jitter() + 
  scale_color_brewer(palette = "Dark2") +
  labs(x = "Consumption-Based CO2 Emissions Per Capita",
       subtitle = "Average Life Expectancy",
       y = "") +
  scale_x_continuous(limits=c(2000,2022),
                     breaks = seq(2000, 2022, 2)) +
  theme_bw()
```

### or Data visualization 1 alternative???

The fct_reorder isn't working as it should be!!

```{r}

vis_1_df %>%  
  ggplot(mapping = aes (x = year,
                        y = life_expectancy_years,
                       color= fct_reorder2(.f = carbon_emissions_tonnes,
                             .x = year,
                             .y = life_expectancy_years))) +
  geom_jitter(alpha = 0.1) + 
  geom_smooth(method = "loess") +
  scale_color_brewer(palette = "Dark2") +
  labs(x = "Year",
       subtitle = "Life Expectancy",
       y = "",
       color = "CO2 Emissions Per Capita") +
  scale_x_continuous(limits=c(2000,2022),
                     breaks = seq(2000, 2022, 2)) +
  theme_bw()

 

```

### Data Visualization 2

So this is just the general carbon emission vs life expectancy graph without considering the countries with the top ten carbon emissions

```{r}
joined_data %>% 
  ggplot(mapping = aes(x = carbon_emissions_tonnes,
                       y = life_expectancy_years)) +
  geom_jitter(alpha = 0.1) +
  geom_smooth(method = "loess")
```

### OR alternative visual 2 (with the top 10 carbon emission countries)

The issue with this graph is that there isn't enough points to really give us a lot of info unless we change up the table or use a different type of graph

```{r}
top_ten_carbon %>% 
  ggplot(mapping = aes(x = avg_crbn,
                       y = avg_life,
                       color = country)) +
  geom_point() 
```
